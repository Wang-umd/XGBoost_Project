# ⚡ 电力负荷预测系统 (Power Load Prediction)

本项目基于历史电力负荷数据，采用 **XGBoost (eXtreme Gradient Boosting)** 算法构建多变量、单步的机器学习回归模型，实现对未来时刻电力负荷的精准预测。

## 📖 项目简介

电力负荷预测是智能电网调度的核心环节。本项目通过对时间序列数据进行深度的特征工程处理（提取时间周期特征与历史滞后特征），结合 XGBoost 强大的非线性拟合能力，实现了高精度的单步负荷预测。项目包含完整的数据预处理、探索性数据分析(EDA)、模型训练、推理预测及结果可视化流程。

## 🛠️ 核心技术栈

* **数据处理与分析**: Pandas, NumPy
* **机器学习算法**: XGBoost (`XGBRegressor`)
* **模型评估与调优**: Scikit-learn (`train_test_split`, `GridSearchCV`, `MSE`, `MAE`)
* **数据可视化**: Matplotlib
* **工程化支持**: 内置 Logging 模块, Joblib (模型序列化)

---

## 📂 文件结构与技术点详解

### 1. `common.py` (通用工具模块)
提供基础的数据预处理和自定义评估指标支持。
* **数据清洗**: `data_preprocessing` 函数负责读取 CSV 文件，将时间列统一格式化为 `%Y-%m-%d %H:%M:%S`。
* **时序对齐**: 强制数据按时间升序排列，并剔除重复记录，保证时序数据的严格连贯性。
* **自定义指标**: 实现了平均绝对百分比误差 (`mean_absolute_percentage_error`) 的计算函数，用于直观衡量预测偏差的百分比。

### 2. `log.py` (日志系统)
规范化的日志记录，便于生产环境的调试与监控。
* **分级控制**: 封装了 `Logger` 类，支持将 `debug`, `info`, `warning`, `error`, `crit` 映射到标准 `logging` 级别。
* **持久化存储**: 自动在项目根目录创建 `log` 文件夹，并使用 `logging.FileHandler` 以追加模式 (`mode="a"`) 保存为 `.log` 文件，支持多线程环境下的稳定写入。
* **格式统一**: 默认采用 `%(asctime)s - %(levelname)s: %(message)s` 格式，确保日志时间戳和信息清晰可读。

### 3. `train.py` (模型训练与特征工程)
包含了从数据探索、特征构造到模型训练与保存的完整生命周期。
* **探索性数据分析 (EDA)**: `ana_data` 函数利用 Matplotlib 绘制四类图表并保存至 `../data/fig/负荷分析图.png`：
    * 负荷分布直方图（观察整体数据分布情况）。
    * 各小时平均负荷趋势图（捕捉日内负荷波动规律）。
    * 各月份平均负荷趋势图（捕捉季节性/年内波动规律）。
    * 工作日与周末的平均负荷对比柱状图（捕捉工作作息对用电的影响）。
* **深度特征工程**: `feature_engineering` 函数实现了多维度的特征构造：
    * **时间独热编码**: 提取 `hour` 和 `month`，并使用 `pd.get_dummies` 转化为 One-Hot 编码，消除离散时间数值带来的大小误导。
    * **滑动窗口特征**: 利用 `shift(1)`, `shift(2)`, `shift(3)` 提取过去 1、2、3 小时的负荷值作为特征。
    * **周期性映射**: 通过时间差计算提取“昨日同时刻”的负荷特征 (`yesterday_load`)，捕捉以天为周期的用电规律。
* **模型训练与评估**:
    * 采用 70% 训练集与 30% 测试集的比例划分数据 (`test_size=0.3`)。
    * 内置了基于 `GridSearchCV` 的网格搜索代码（注释状态）用于寻找最佳超参数组合。
    * 最终采用 `XGBRegressor` 训练，核心参数设置为 `n_estimators=150, max_depth=6, learning_rate=0.1`。
    * 使用均方误差 (MSE) 和平均绝对误差 (MAE) 评估模型在训练集和测试集上的表现，并通过 `joblib.dump` 将模型序列化保存为 `../model/xgb2.pkl`。

### 4. `predict.py` (模型推理与评估)
模拟生产环境下的实时/离线预测过程。
* **高效特征提取**: 
    * `pred_feature_extract` 函数针对给定的预测时间点，动态解析并构造出与训练集严格一致的 40 维特征向量（包含 24 小时独热、12 个月独热，以及前 3 小时和昨日同时刻的负荷）。
    * 在处理缺失历史负荷时，采用了字典的 `get` 方法并设置默认值 `600`，增强了代码的鲁棒性。
* **性能优化**: `PowerLoadPredict` 类在初始化时，巧妙地将历史 DataFrame 转换为字典 (`set_index('time')['power_load'].to_dict()`)，将查找历史负荷的时间复杂度从 O(N) 降至 O(1)，极大提升了循环预测的效率。
* **预测与可视化**: 
    * 加载 `../model/xgb2.pkl` 模型。
    * 对时间大于等于 `2015-08-01 00:00:00` 的数据进行逐条预测。
    * 通过 `prediction_plot` 绘制“预测负荷与真实负荷”的对比折线图，并将结果图保存至 `../data/fig/预测效果.png`。
